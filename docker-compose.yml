# Docker Compose —Ñ–∞–π–ª –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Nginx + Curl
version: '3.8'

services:
  nginx:
    image: polina:1
    
    container_name: my-nginx-server
    
    ports:
      - "8080:80"
    
    volumes:
      # –ú–æ–Ω—Ç–∏—Ä—É—é –ø–∞–ø–∫—É —Å HTML —Ñ–∞–π–ª–∞–º–∏ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –ø–∞–ø–∫—É Nginx
      - ./html:/usr/share/nginx/html

      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
    
    networks:
      - app-network
    
    restart: unless-stopped

  curl-tester:
    image: curlimages/curl
    
    container_name: curl-http-tester
    
    depends_on:
      - nginx
    
    # –ö–æ–º–∞–Ω–¥–∞, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
    command: >
      sh -c "
        echo 'üïê –û–∂–∏–¥–∞–µ–º –∑–∞–ø—É—Å–∫ Nginx...' &&

        # –ñ–¥–µ–º 5 —Å–µ–∫—É–Ω–¥ —á—Ç–æ–±—ã Nginx —Ç–æ—á–Ω–æ –∑–∞–ø—É—Å—Ç–∏–ª—Å—è
        sleep 5 &&

        echo 'üöÄ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º GET –∑–∞–ø—Ä–æ—Å –∫ Nginx...' &&
        echo '================================' &&

        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º GET –∑–∞–ø—Ä–æ—Å —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
        curl -v http://nginx/ &&

        echo '' &&
        echo '================================' &&
        echo '‚úÖ –ó–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω!' &&
        echo '' &&
        echo 'üåê –í—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ:' &&
        echo '   http://localhost:8080'
      "
  
    networks:
      - app-network
    
    # –≠—Ç–æ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–≤–µ—Ä—à–∏—Ç —Ä–∞–±–æ—Ç—É –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã
    restart: "no"

networks:
  app-network:
    driver: bridge
    
    ipam:
      config:
        - subnet: 172.20.0.0/16

